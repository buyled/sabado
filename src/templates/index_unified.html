<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoManage - Gesti√≥n Empresarial</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ============================================================================ */
        /* VARIABLES CSS Y RESET */
        /* ============================================================================ */
        :root {
            /* Colores principales */
            --primary-50: #F0EDFF;
            --primary-100: #E0D9FF;
            --primary-200: #C7B8FF;
            --primary-300: #A690FF;
            --primary-400: #8B6FFF;
            --primary-500: #7B61FF;
            --primary-600: #6B4EE6;
            --primary-700: #5A3FCC;
            --primary-800: #4A33B3;
            --primary-900: #3D2A99;

            /* Colores neutros */
            --neutral-0: #FFFFFF;
            --neutral-50: #FAFBFC;
            --neutral-100: #F4F6F8;
            --neutral-200: #E8ECEF;
            --neutral-300: #D1D9E0;
            --neutral-400: #B4BCC4;
            --neutral-500: #8B95A1;
            --neutral-600: #6B7684;
            --neutral-700: #4E5A6B;
            --neutral-800: #364152;
            --neutral-900: #1F2937;

            /* Colores de estado */
            --success-500: #10B981;
            --warning-500: #F59E0B;
            --error-500: #EF4444;
            --info-500: #3B82F6;

            /* Espaciado */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            --space-10: 40px;
            --space-12: 48px;
            --space-16: 64px;

            /* Bordes */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;

            /* Sombras */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

            /* Tipograf√≠a */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-base: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            --font-size-2xl: 24px;
            --font-size-3xl: 30px;
            --font-size-4xl: 36px;

            /* Transiciones */
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            line-height: 1.6;
            color: var(--neutral-900);
            background-color: var(--neutral-50);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ============================================================================ */
        /* LAYOUT PRINCIPAL */
        /* ============================================================================ */
        .app-container {
            display: flex;
            min-height: 100vh;
            background: var(--neutral-50);
        }

        /* ============================================================================ */
        /* SIDEBAR */
        /* ============================================================================ */
        .sidebar {
            width: 280px;
            background: var(--neutral-0);
            border-right: 1px solid var(--neutral-200);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .sidebar-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--neutral-200);
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-xl);
            font-weight: 700;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .sidebar-nav {
            padding: var(--space-4);
        }

        .nav-section {
            margin-bottom: var(--space-6);
        }

        .nav-section-title {
            font-size: var(--font-size-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--neutral-500);
            margin-bottom: var(--space-3);
            padding: 0 var(--space-3);
        }

        .nav-item {
            margin-bottom: var(--space-1);
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-3);
            color: var(--neutral-700);
            text-decoration: none;
            border-radius: var(--radius-md);
            font-weight: 500;
            transition: all var(--transition-fast);
            position: relative;
        }

        .nav-link:hover {
            background: var(--neutral-100);
            color: var(--primary-600);
            transform: translateX(2px);
        }

        .nav-link.active {
            background: var(--primary-50);
            color: var(--primary-700);
            font-weight: 600;
        }

        .nav-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 20px;
            background: var(--primary-500);
            border-radius: 0 2px 2px 0;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .nav-badge {
            background: var(--primary-500);
            color: white;
            font-size: var(--font-size-xs);
            font-weight: 600;
            padding: 2px 6px;
            border-radius: var(--radius-full);
            margin-left: auto;
        }

        /* ============================================================================ */
        /* CONTENIDO PRINCIPAL */
        /* ============================================================================ */
        .main-content {
            flex: 1;
            margin-left: 280px;
            background: var(--neutral-50);
            min-height: 100vh;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .page-header {
            background: var(--neutral-0);
            border-bottom: 1px solid var(--neutral-200);
            padding: var(--space-6) var(--space-8);
        }

        .page-title {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .page-subtitle {
            font-size: var(--font-size-lg);
            color: var(--neutral-600);
        }

        .page-content {
            padding: var(--space-8);
        }

        /* ============================================================================ */
        /* COMPONENTES */
        /* ============================================================================ */

        /* Botones */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            border: none;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: var(--font-size-sm);
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--primary-500);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-600);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--neutral-100);
            color: var(--neutral-700);
            border: 1px solid var(--neutral-300);
        }

        .btn-secondary:hover {
            background: var(--neutral-200);
            border-color: var(--neutral-400);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-600);
            border: 1px solid var(--primary-300);
        }

        .btn-outline:hover {
            background: var(--primary-50);
            border-color: var(--primary-500);
        }

        /* Cards */
        .card {
            background: var(--neutral-0);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: all var(--transition-normal);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--neutral-200);
            background: var(--neutral-50);
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--neutral-900);
            margin-bottom: var(--space-1);
        }

        .card-subtitle {
            font-size: var(--font-size-sm);
            color: var(--neutral-600);
        }

        .card-content {
            padding: var(--space-6);
        }

        /* Estados de carga */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--neutral-300);
            border-radius: 50%;
            border-top-color: var(--primary-500);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-16);
            color: var(--neutral-600);
        }

        .loading-state .loading-spinner {
            width: 40px;
            height: 40px;
            margin-bottom: var(--space-4);
        }

        /* Estados de error */
        .error-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-16);
            color: var(--error-500);
            text-align: center;
        }

        .error-icon {
            font-size: 48px;
            margin-bottom: var(--space-4);
        }

        /* Estado de conexi√≥n */
        .connection-status {
            position: fixed;
            top: var(--space-4);
            right: var(--space-4);
            z-index: 1001;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-2);
            box-shadow: var(--shadow-lg);
        }

        .connection-status.connected {
            background: var(--success-500);
            color: white;
        }

        .connection-status.disconnected {
            background: var(--error-500);
            color: white;
        }

        .connection-status.connecting {
            background: var(--warning-500);
            color: white;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        .status-indicator.pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ============================================================================ */
        /* RESPONSIVE */
        /* ============================================================================ */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform var(--transition-normal);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-toggle {
                display: flex;
                position: fixed;
                top: var(--space-4);
                left: var(--space-4);
                z-index: 1001;
                width: 44px;
                height: 44px;
                background: var(--primary-500);
                color: white;
                border: none;
                border-radius: var(--radius-md);
                align-items: center;
                justify-content: center;
                cursor: pointer;
                box-shadow: var(--shadow-lg);
            }

            .page-header {
                padding: var(--space-6) var(--space-4);
                padding-top: calc(var(--space-6) + 60px);
            }

            .page-content {
                padding: var(--space-4);
            }
        }

        .mobile-menu-toggle {
            display: none;
        }

        /* Overlay para m√≥vil */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        @media (max-width: 768px) {
            .sidebar-overlay.active {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Estado de conexi√≥n -->
    <div class="connection-status connecting" id="connectionStatus">
        <div class="status-indicator pulse"></div>
        <span id="connectionText">Conectando...</span>
    </div>

    <!-- Bot√≥n men√∫ m√≥vil -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Overlay para m√≥vil -->
    <div class="sidebar-overlay" onclick="closeMobileMenu()" id="sidebarOverlay"></div>

    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div>
                        <div>GoManage</div>
                        <div style="font-size: 12px; opacity: 0.8;">Gesti√≥n Empresarial</div>
                    </div>
                </div>
            </div>

            <div class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Principal</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link active" onclick="switchSection('dashboard', event)">
                            <div class="nav-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Gesti√≥n</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="switchSection('customers', event)">
                            <div class="nav-icon"><i class="fas fa-users"></i></div>
                            Clientes
                            <div class="nav-badge" id="customersBadge">-</div>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="switchSection('create-customer', event)">
                            <div class="nav-icon"><i class="fas fa-user-plus"></i></div>
                            Alta de Cliente
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="switchSection('sales-orders', event)">
                            <div class="nav-icon"><i class="fas fa-shopping-cart"></i></div>
                            Pedidos de Venta
                            <div class="nav-badge" id="ordersBadge">-</div>
                        </a>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Herramientas</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="switchSection('analytics', event)">
                            <div class="nav-icon"><i class="fas fa-chart-bar"></i></div>
                            An√°lisis
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" onclick="switchSection('settings', event)">
                            <div class="nav-icon"><i class="fas fa-cog"></i></div>
                            Configuraci√≥n
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Contenido principal -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <div class="content-section active" id="dashboard">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </h1>
                    <p class="page-subtitle">Resumen general de tu negocio</p>
                </div>
                
                <div class="page-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üéâ Bienvenido a GoManage</h2>
                            <p class="card-subtitle">Sistema de gesti√≥n empresarial unificado</p>
                        </div>
                        <div class="card-content">
                            <p style="margin-bottom: var(--space-6);">
                                Tu aplicaci√≥n de gesti√≥n empresarial con arquitectura mejorada y funcionalidades avanzadas.
                            </p>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-6);">
                                <div class="card">
                                    <div class="card-content">
                                        <h3 style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                                            <i class="fas fa-users" style="color: var(--primary-500);"></i>
                                            Gesti√≥n de Clientes
                                        </h3>
                                        <p style="color: var(--neutral-600); margin-bottom: var(--space-4);">
                                            Sistema completo para gestionar tu base de clientes con b√∫squeda avanzada.
                                        </p>
                                        <button class="btn btn-outline" onclick="switchSection('customers', event)">
                                            Ver Clientes
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-content">
                                        <h3 style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                                            <i class="fas fa-user-plus" style="color: var(--success-500);"></i>
                                            Alta de Cliente
                                        </h3>
                                        <p style="color: var(--neutral-600); margin-bottom: var(--space-4);">
                                            Formulario mejorado para crear nuevos clientes con validaci√≥n en tiempo real.
                                        </p>
                                        <button class="btn btn-outline" onclick="switchSection('create-customer', event)">
                                            Crear Cliente
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-content">
                                        <h3 style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                                            <i class="fas fa-shopping-cart" style="color: var(--warning-500);"></i>
                                            Pedidos de Venta
                                        </h3>
                                        <p style="color: var(--neutral-600); margin-bottom: var(--space-4);">
                                            Gesti√≥n completa de pedidos con filtros avanzados y seguimiento.
                                        </p>
                                        <button class="btn btn-outline" onclick="switchSection('sales-orders', event)">
                                            Ver Pedidos
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-content">
                                        <h3 style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-3);">
                                            <i class="fas fa-chart-bar" style="color: var(--info-500);"></i>
                                            An√°lisis
                                        </h3>
                                        <p style="color: var(--neutral-600); margin-bottom: var(--space-4);">
                                            Dashboard con m√©tricas en tiempo real y reportes personalizados.
                                        </p>
                                        <button class="btn btn-outline" onclick="switchSection('analytics', event)">
                                            Ver An√°lisis
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: var(--space-8); text-align: center;">
                                <button class="btn btn-primary" onclick="initializeApp()">
                                    <i class="fas fa-rocket"></i>
                                    Inicializar Sistema
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Otras secciones se cargar√°n din√°micamente -->
            <div class="content-section" id="customers"></div>
            <div class="content-section" id="create-customer"></div>
            <div class="content-section" id="sales-orders"></div>
            <div class="content-section" id="analytics"></div>
            <div class="content-section" id="settings"></div>
        </main>
    </div>

    <script>
        // ============================================================================
        // VARIABLES GLOBALES
        // ============================================================================
        let currentSection = 'dashboard';
        let loadedSections = new Set(['dashboard']);
        let isInitialized = false;
        let connectionStatus = 'connecting';

        // ============================================================================
        // GESTI√ìN DE CONEXI√ìN
        // ============================================================================
        function updateConnectionStatus(status, message = '') {
            connectionStatus = status;
            const statusElement = document.getElementById('connectionStatus');
            const textElement = document.getElementById('connectionText');
            
            statusElement.className = `connection-status ${status}`;
            
            switch(status) {
                case 'connected':
                    textElement.textContent = 'Conectado';
                    break;
                case 'disconnected':
                    textElement.textContent = message || 'Desconectado';
                    break;
                case 'connecting':
                    textElement.textContent = 'Conectando...';
                    break;
                case 'error':
                    textElement.textContent = message || 'Error de conexi√≥n';
                    break;
            }
        }

        // ============================================================================
        // INICIALIZACI√ìN DE LA APLICACI√ìN
        // ============================================================================
        async function initializeApp() {
            if (isInitialized) {
                console.log('‚úÖ Aplicaci√≥n ya inicializada');
                return;
            }

            console.log('üöÄ Inicializando GoManage...');
            updateConnectionStatus('connecting');

            try {
                // Verificar estado del servidor
                const healthResponse = await fetch('/health');
                const healthData = await healthResponse.json();
                
                console.log('üìä Estado del servidor:', healthData);

                if (healthData.status === 'healthy') {
                    // Intentar autenticaci√≥n si es necesaria
                    if (!healthData.session_valid) {
                        console.log('üîê Iniciando autenticaci√≥n...');
                        const authResponse = await fetch('/api/auth', { method: 'POST' });
                        const authData = await authResponse.json();
                        
                        if (authData.status === 'success') {
                            console.log('‚úÖ Autenticaci√≥n exitosa');
                        } else {
                            console.warn('‚ö†Ô∏è Autenticaci√≥n fall√≥, continuando en modo limitado');
                        }
                    }

                    // Cargar datos iniciales del dashboard
                    await loadDashboardData();
                    
                    updateConnectionStatus('connected');
                    isInitialized = true;
                    console.log('‚úÖ Aplicaci√≥n inicializada correctamente');
                } else {
                    throw new Error('Servidor no disponible');
                }
            } catch (error) {
                console.error('‚ùå Error inicializando aplicaci√≥n:', error);
                updateConnectionStatus('error', 'Error de inicializaci√≥n');
            }
        }

        async function loadDashboardData() {
            try {
                const response = await fetch('/api/dashboard');
                const data = await response.json();
                
                if (data.status === 'success') {
                    // Actualizar badges en el sidebar
                    const customersCount = data.data.total_customers;
                    const ordersCount = data.data.active_orders;
                    
                    document.getElementById('customersBadge').textContent = customersCount || '0';
                    document.getElementById('ordersBadge').textContent = ordersCount || '0';
                    
                    console.log('üìä Dashboard actualizado:', data.data);
                } else {
                    console.warn('‚ö†Ô∏è Error cargando dashboard:', data.message);
                }
            } catch (error) {
                console.error('‚ùå Error cargando dashboard:', error);
            }
        }

        // ============================================================================
        // NAVEGACI√ìN ENTRE SECCIONES
        // ============================================================================
        function switchSection(sectionId, event) {
            if (event) {
                event.preventDefault();
            }

            console.log(`üìÑ Cambiando a secci√≥n: ${sectionId}`);

            // Actualizar navegaci√≥n activa
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            if (event && event.target.closest('.nav-link')) {
                event.target.closest('.nav-link').classList.add('active');
            }

            // Ocultar secci√≥n actual
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Mostrar nueva secci√≥n
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                currentSection = sectionId;

                // Cargar contenido si no est√° cargado
                if (!loadedSections.has(sectionId)) {
                    loadSectionContent(sectionId);
                }

                // Cerrar men√∫ m√≥vil
                closeMobileMenu();
            }
        }

        // ============================================================================
        // CARGA DIN√ÅMICA DE CONTENIDO
        // ============================================================================
        async function loadSectionContent(sectionId) {
            const section = document.getElementById(sectionId);
            
            // Mostrar estado de carga
            section.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-${getSectionIcon(sectionId)}"></i>
                        ${getSectionTitle(sectionId)}
                    </h1>
                    <p class="page-subtitle">Cargando contenido...</p>
                </div>
                <div class="page-content">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Cargando ${getSectionTitle(sectionId)}...</p>
                    </div>
                </div>
            `;

            try {
                switch(sectionId) {
                    case 'customers':
                        await loadCustomersSection(section);
                        break;
                    case 'create-customer':
                        await loadCreateCustomerSection(section);
                        break;
                    case 'sales-orders':
                        await loadSalesOrdersSection(section);
                        break;
                    case 'analytics':
                        await loadAnalyticsSection(section);
                        break;
                    case 'settings':
                        await loadSettingsSection(section);
                        break;
                    default:
                        loadDefaultSection(section, sectionId);
                        break;
                }
                
                loadedSections.add(sectionId);
                console.log(`‚úÖ Secci√≥n ${sectionId} cargada`);
                
            } catch (error) {
                console.error(`‚ùå Error cargando secci√≥n ${sectionId}:`, error);
                loadErrorSection(section, sectionId, error.message);
            }
        }

        function getSectionTitle(sectionId) {
            const titles = {
                'customers': 'Clientes',
                'create-customer': 'Alta de Cliente',
                'sales-orders': 'Pedidos de Venta',
                'analytics': 'An√°lisis',
                'settings': 'Configuraci√≥n'
            };
            return titles[sectionId] || 'Contenido';
        }

        function getSectionIcon(sectionId) {
            const icons = {
                'customers': 'users',
                'create-customer': 'user-plus',
                'sales-orders': 'shopping-cart',
                'analytics': 'chart-bar',
                'settings': 'cog'
            };
            return icons[sectionId] || 'file';
        }

        // ============================================================================
        // CARGADORES DE SECCIONES ESPEC√çFICAS
        // ============================================================================
        async function loadCustomersSection(section) {
            const response = await fetch('/api/customers?page=1&per_page=20');
            const data = await response.json();
            
            if (data.status === 'success') {
                section.innerHTML = `
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-users"></i>
                            Clientes
                        </h1>
                        <p class="page-subtitle">Gesti√≥n de clientes (${data.pagination.total} total)</p>
                    </div>
                    <div class="page-content">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Lista de Clientes</h2>
                                <p class="card-subtitle">P√°gina ${data.pagination.page} de ${data.pagination.pages}</p>
                            </div>
                            <div class="card-content">
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="border-bottom: 2px solid var(--neutral-200);">
                                                <th style="padding: var(--space-3); text-align: left;">ID</th>
                                                <th style="padding: var(--space-3); text-align: left;">Raz√≥n Social</th>
                                                <th style="padding: var(--space-3); text-align: left;">CIF/NIF</th>
                                                <th style="padding: var(--space-3); text-align: left;">Ciudad</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${data.customers.map(customer => `
                                                <tr style="border-bottom: 1px solid var(--neutral-200);">
                                                    <td style="padding: var(--space-3);">${customer.customer_id || '-'}</td>
                                                    <td style="padding: var(--space-3); font-weight: 600;">${customer.business_name || customer.name || '-'}</td>
                                                    <td style="padding: var(--space-3);">${customer.vat_number || '-'}</td>
                                                    <td style="padding: var(--space-3);">${customer.city || '-'}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                                <div style="margin-top: var(--space-6); display: flex; justify-content: space-between; align-items: center;">
                                    <p style="color: var(--neutral-600);">
                                        Mostrando ${data.customers.length} de ${data.pagination.total} clientes
                                    </p>
                                    <div style="display: flex; gap: var(--space-2);">
                                        <button class="btn btn-secondary" ${data.pagination.page === 1 ? 'disabled' : ''}>
                                            Anterior
                                        </button>
                                        <button class="btn btn-secondary" ${data.pagination.page === data.pagination.pages ? 'disabled' : ''}>
                                            Siguiente
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                throw new Error(data.message || 'Error cargando clientes');
            }
        }

        async function loadCreateCustomerSection(section) {
            section.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-user-plus"></i>
                        Alta de Cliente
                    </h1>
                    <p class="page-subtitle">Crear nuevo cliente en el sistema</p>
                </div>
                <div class="page-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Formulario de Cliente</h2>
                            <p class="card-subtitle">Complete los datos del nuevo cliente</p>
                        </div>
                        <div class="card-content">
                            <form id="createCustomerForm" onsubmit="createCustomer(event)">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-6);">
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">
                                            Raz√≥n Social *
                                        </label>
                                        <input type="text" name="business_name" required 
                                               style="width: 100%; padding: var(--space-3); border: 1px solid var(--neutral-300); border-radius: var(--radius-md);">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">
                                            Nombre Comercial *
                                        </label>
                                        <input type="text" name="name" required 
                                               style="width: 100%; padding: var(--space-3); border: 1px solid var(--neutral-300); border-radius: var(--radius-md);">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">
                                            CIF/NIF *
                                        </label>
                                        <input type="text" name="vat_number" required 
                                               style="width: 100%; padding: var(--space-3); border: 1px solid var(--neutral-300); border-radius: var(--radius-md);">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">
                                            Ciudad
                                        </label>
                                        <input type="text" name="city" 
                                               style="width: 100%; padding: var(--space-3); border: 1px solid var(--neutral-300); border-radius: var(--radius-md);">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">
                                            Direcci√≥n
                                        </label>
                                        <input type="text" name="street_name" 
                                               style="width: 100%; padding: var(--space-3); border: 1px solid var(--neutral-300); border-radius: var(--radius-md);">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: var(--space-2); font-weight: 600;">
                                            C√≥digo Postal
                                        </label>
                                        <input type="text" name="postal_code" 
                                               style="width: 100%; padding: var(--space-3); border: 1px solid var(--neutral-300); border-radius: var(--radius-md);">
                                    </div>
                                </div>
                                <div style="margin-top: var(--space-8); display: flex; gap: var(--space-4);">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Crear Cliente
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('createCustomerForm').reset()">
                                        <i class="fas fa-undo"></i>
                                        Limpiar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadSalesOrdersSection(section) {
            const response = await fetch('/api/sales-orders?page=1&per_page=20');
            const data = await response.json();
            
            if (data.status === 'success') {
                section.innerHTML = `
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-shopping-cart"></i>
                            Pedidos de Venta
                        </h1>
                        <p class="page-subtitle">Gesti√≥n de pedidos (${data.pagination.total} total)</p>
                    </div>
                    <div class="page-content">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Lista de Pedidos</h2>
                                <p class="card-subtitle">P√°gina ${data.pagination.page} de ${data.pagination.pages}</p>
                            </div>
                            <div class="card-content">
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="border-bottom: 2px solid var(--neutral-200);">
                                                <th style="padding: var(--space-3); text-align: left;">ID</th>
                                                <th style="padding: var(--space-3); text-align: left;">Cliente</th>
                                                <th style="padding: var(--space-3); text-align: left;">Fecha</th>
                                                <th style="padding: var(--space-3); text-align: left;">Total</th>
                                                <th style="padding: var(--space-3); text-align: left;">Estado</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${data.sales_orders.map(order => `
                                                <tr style="border-bottom: 1px solid var(--neutral-200);">
                                                    <td style="padding: var(--space-3);">${order.invoice_id || order.id || '-'}</td>
                                                    <td style="padding: var(--space-3); font-weight: 600;">${order.business_name || order.customer_name || '-'}</td>
                                                    <td style="padding: var(--space-3);">${order.date ? new Date(order.date).toLocaleDateString('es-ES') : '-'}</td>
                                                    <td style="padding: var(--space-3);">${order.amount ? parseFloat(order.amount).toLocaleString('es-ES', {style: 'currency', currency: 'EUR'}) : '-'}</td>
                                                    <td style="padding: var(--space-3);">
                                                        <span style="padding: 4px 8px; border-radius: var(--radius-full); background: var(--warning-500); color: white; font-size: 12px;">
                                                            ${order.is_delivered ? 'Entregado' : order.is_confirmed ? 'Confirmado' : 'Pendiente'}
                                                        </span>
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                                <div style="margin-top: var(--space-6); display: flex; justify-content: space-between; align-items: center;">
                                    <p style="color: var(--neutral-600);">
                                        Mostrando ${data.sales_orders.length} de ${data.pagination.total} pedidos
                                    </p>
                                    <div style="display: flex; gap: var(--space-2);">
                                        <button class="btn btn-secondary" ${data.pagination.page === 1 ? 'disabled' : ''}>
                                            Anterior
                                        </button>
                                        <button class="btn btn-secondary" ${data.pagination.page === data.pagination.pages ? 'disabled' : ''}>
                                            Siguiente
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                throw new Error(data.message || 'Error cargando pedidos');
            }
        }

        async function loadAnalyticsSection(section) {
            section.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-chart-bar"></i>
                        An√°lisis
                    </h1>
                    <p class="page-subtitle">M√©tricas y reportes del negocio</p>
                </div>
                <div class="page-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Dashboard de An√°lisis</h2>
                            <p class="card-subtitle">Pr√≥ximamente disponible</p>
                        </div>
                        <div class="card-content">
                            <div style="text-align: center; padding: var(--space-16);">
                                <i class="fas fa-chart-line" style="font-size: 64px; color: var(--neutral-400); margin-bottom: var(--space-4);"></i>
                                <h3 style="margin-bottom: var(--space-2);">M√≥dulo de An√°lisis</h3>
                                <p style="color: var(--neutral-600); margin-bottom: var(--space-6);">
                                    Esta secci√≥n incluir√° gr√°ficos interactivos, KPIs y reportes personalizados.
                                </p>
                                <button class="btn btn-primary" onclick="alert('Funcionalidad en desarrollo')">
                                    <i class="fas fa-rocket"></i>
                                    Pr√≥ximamente
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadSettingsSection(section) {
            section.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-cog"></i>
                        Configuraci√≥n
                    </h1>
                    <p class="page-subtitle">Configuraci√≥n del sistema</p>
                </div>
                <div class="page-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Configuraci√≥n del Sistema</h2>
                            <p class="card-subtitle">Ajustes y preferencias</p>
                        </div>
                        <div class="card-content">
                            <div style="text-align: center; padding: var(--space-16);">
                                <i class="fas fa-cogs" style="font-size: 64px; color: var(--neutral-400); margin-bottom: var(--space-4);"></i>
                                <h3 style="margin-bottom: var(--space-2);">Panel de Configuraci√≥n</h3>
                                <p style="color: var(--neutral-600); margin-bottom: var(--space-6);">
                                    Aqu√≠ podr√°s configurar las preferencias del sistema, usuarios y permisos.
                                </p>
                                <button class="btn btn-primary" onclick="alert('Funcionalidad en desarrollo')">
                                    <i class="fas fa-tools"></i>
                                    Pr√≥ximamente
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadDefaultSection(section, sectionId) {
            const title = getSectionTitle(sectionId);
            section.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-${getSectionIcon(sectionId)}"></i>
                        ${title}
                    </h1>
                    <p class="page-subtitle">Secci√≥n en desarrollo</p>
                </div>
                <div class="page-content">
                    <div class="card">
                        <div class="card-content">
                            <div style="text-align: center; padding: var(--space-16);">
                                <i class="fas fa-hammer" style="font-size: 64px; color: var(--neutral-400); margin-bottom: var(--space-4);"></i>
                                <h3 style="margin-bottom: var(--space-2);">En Desarrollo</h3>
                                <p style="color: var(--neutral-600); margin-bottom: var(--space-6);">
                                    Esta secci√≥n estar√° disponible pr√≥ximamente.
                                </p>
                                <button class="btn btn-outline" onclick="switchSection('dashboard', event)">
                                    <i class="fas fa-home"></i>
                                    Volver al Dashboard
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadErrorSection(section, sectionId, errorMessage) {
            const title = getSectionTitle(sectionId);
            section.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-${getSectionIcon(sectionId)}"></i>
                        ${title}
                    </h1>
                    <p class="page-subtitle">Error cargando contenido</p>
                </div>
                <div class="page-content">
                    <div class="card">
                        <div class="card-content">
                            <div class="error-state">
                                <i class="fas fa-exclamation-triangle error-icon"></i>
                                <h3 style="margin-bottom: var(--space-2);">Error de Carga</h3>
                                <p style="color: var(--neutral-600); margin-bottom: var(--space-4);">
                                    ${errorMessage}
                                </p>
                                <div style="display: flex; gap: var(--space-3); justify-content: center;">
                                    <button class="btn btn-primary" onclick="loadSectionContent('${sectionId}')">
                                        <i class="fas fa-redo"></i>
                                        Reintentar
                                    </button>
                                    <button class="btn btn-outline" onclick="switchSection('dashboard', event)">
                                        <i class="fas fa-home"></i>
                                        Volver al Dashboard
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================================================
        // FUNCIONES DE FORMULARIOS
        // ============================================================================
        async function createCustomer(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const customerData = Object.fromEntries(formData.entries());
            
            // Mostrar estado de carga
            const submitButton = form.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '<div class="loading-spinner"></div> Creando...';
            submitButton.disabled = true;
            
            try {
                const response = await fetch('/api/customers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(customerData)
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    alert('‚úÖ Cliente creado exitosamente');
                    form.reset();
                    
                    // Invalidar cache de clientes si est√° cargado
                    if (loadedSections.has('customers')) {
                        loadedSections.delete('customers');
                    }
                } else {
                    alert('‚ùå Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error creando cliente:', error);
                alert('‚ùå Error de conexi√≥n al crear cliente');
            } finally {
                // Restaurar bot√≥n
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        }

        // ============================================================================
        // FUNCIONES DE MEN√ö M√ìVIL
        // ============================================================================
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        }

        // ============================================================================
        // INICIALIZACI√ìN
        // ============================================================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ GoManage cargado');
            
            // Inicializar autom√°ticamente
            setTimeout(initializeApp, 1000);
            
            // Configurar eventos de teclado
            document.addEventListener('keydown', function(e) {
                // Escape para cerrar men√∫ m√≥vil
                if (e.key === 'Escape') {
                    closeMobileMenu();
                }
            });
            
            // Verificar conexi√≥n peri√≥dicamente
            setInterval(async function() {
                try {
                    const response = await fetch('/health');
                    const data = await response.json();
                    
                    if (data.status === 'healthy') {
                        if (connectionStatus !== 'connected') {
                            updateConnectionStatus('connected');
                        }
                    } else {
                        updateConnectionStatus('error', 'Servidor no disponible');
                    }
                } catch (error) {
                    updateConnectionStatus('disconnected', 'Sin conexi√≥n');
                }
            }, 30000); // Cada 30 segundos
        });
    </script>
</body>
</html>